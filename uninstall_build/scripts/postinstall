#!/bin/bash
set -e

echo "Uninstalling Blocky..."

# Stop scheduler if running
if pgrep -f blocker_scheduler >/dev/null; then
  echo "Stopping Blocky scheduler..."
  pkill -f blocker_scheduler
fi

# Remove files
echo "Removing Blocky app..."
rm -rf /Applications/Blocky.app

echo "Removing helper binaries..."
rm -f /usr/local/bin/blocker_helper
rm -f /usr/local/bin/blocker_scheduler

# Remove LaunchDaemon if you add it later
if [ -f /Library/LaunchDaemons/com.blocky.scheduler.plist ]; then
  launchctl unload /Library/LaunchDaemons/com.blocky.scheduler.plist || true
  rm -f /Library/LaunchDaemons/com.blocky.scheduler.plist
fi

# Remove user data (optional but safe)
if [ -d "$HOME/Library/Application Support/Blocky" ]; then
  rm -rf "$HOME/Library/Application Support/Blocky"
fi

echo "Blocky successfully uninstalled."
